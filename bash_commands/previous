number=$2
filepath=$1
count=0
filename=$(basename "$filepath")
gitnumber=$((number + 1))

mapfile -t commits < <(git log --follow -n "${gitnumber}" --format="%h" "${filepath}")
array_length=${#commits[@]}

current_filename="current_${filename}"

cp "$filepath" "$current_filename"

for item in "${commits[@]}"
do
    (( count++ ))
    git checkout "$item" "$filepath"
    bettercount=$((count - 1))
    if [ "$count" -ne 1 ]; then
      if [ $count == $array_length ]; then
        cp "$filepath" "previous_${bettercount}_${filename}"
      else
        mv "$filepath" "previous_${bettercount}_${filename}"
      fi
    fi
done


# doc = App.ActiveDocument

# if doc:
#     parent_objects = [obj for obj in doc.Objects if obj.InList == []]
#     for obj in parent_objects:
#         print(obj.Label)
# else:
#     print("No active document.")

# doc = App.ActiveDocument
# if doc:
#     parent_objects = [obj for obj in doc.Objects if obj.InList == []]
#     for obj in parent_objects:
#         __objs__=[]
#         __objs__.append(obj)
#         import Mesh
#         Mesh.export(__objs__,u"/Users/markrosenberg/robots/butterfly/parts/{}.stl".format(obj.Label))

#         del __objs__
#         print(obj.Label)
# else:
#     print("No active document.")



# __objs__=[]
# __objs__.append(FreeCAD.getDocument("stem").getObject("Body002"))
# import Mesh
# Mesh.export(__objs__,u"/Users/markrosenberg/robots/butterfly/parts/stem-flap-lever.stl")

# del __objs__



# doc = App.ActiveDocument
# parent_objects = [obj for obj in doc.Objects if obj.InList == []]
# __objs__=[]
# for obj in parent_objects:
#     __objs__.append(obj)

# import Mesh
# Mesh.export(__objs__,u"/Users/markrosenberg/robots/butterfly/parts/full_assembly.stl".format)
# del __objs__



# #full assembly

# doc = App.ActiveDocument
# parent_objects = [obj for obj in doc.Objects if obj.InList == []]
# __objs__ = [obj for obj in parent_objects]

# stl_file_path = "/Users/markrosenberg/robots/butterfly/parts/full_assembly.stl"
# Mesh.export(__objs__, stl_file_path)

# del __objs__
